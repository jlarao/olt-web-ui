<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultado</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">

    <!-- jQuery + DataTables JS -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        pre {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 6px; border: 1px solid #ccc; }
        th { background-color: #f2f2f2; }
        h2 { margin-top: 30px; }
    </style>
</head>
<body class="bg-light">
    <h1>ONTs por Puerto</h1>

{% for puerto, onts in datos_por_puerto.items() %}
    <h2>Puerto {{ puerto }}</h2>
    <table id="tabla_{{ puerto|replace('/', '_') }}" class="display">
        <thead>
            <tr>
                <th>ID</th><th>Estado</th><th>Uptime</th><th>Downtime</th><th>Causa</th>
                <th>SN</th><th>Tipo</th><th>Distancia</th><th>Rx/Tx</th><th>Descripción</th>
                <th>SP</th><th>.</th><th>...</th>
            </tr>
        </thead>
        <tbody>
            {% for ont in onts.values() %}
            <tr>
                <td>{{ ont.ont_id }}</td>
                <td>
                    {% if ont.state == 'online' %}
                        ✅ {{ ont.state }}
                    {% else %}
                        ❌ {{ ont.state }}
                    {% endif %}

                    </td>
                <td>{{ ont.uptime }}</td>
                <td>{{ ont.downtime }}</td>
                <td>{{ ont.down_cause }}</td>
                <td>{{ ont.sn or "-" }}</td>
                <td>{{ ont.type or "-" }}</td>
                <td>{{ ont.distance or "-" }}</td>
                <td>{{ ont.rx_tx or "-" }}</td>
                <td>{{ ont.description or "-" }}</td>
                <td>
                    {% if ont.has_service_port %}
                        ✅
                    {% else %}
                        ❌
                    {% endif %}
                </td>
                <td>
                    {% if ont.has_service_port %}
                        {{ ont.service_port_num }}
                    {% endif %}
                </td>
                <td>
                <a href="{{ ont.editar_url }}">Editar</a> |
                {% if ont.has_service_port %}                
                    <a href="{{ ont.borrar_ont }}{{ ont.borrar_sp }}">❌ Ont</a>
                    <a href="{{ ont.borrar_sp }}">❌Service</a>
                {% else %}
                    <a href="{{ ont.borrar_ont }}">❌ Ont</a>
                    
                {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endfor %}

<script>
  $(document).ready(function() {
    {% for puerto, _ in datos_por_puerto.items() %}
      $('#tabla_{{ puerto|replace("/", "_") }}').DataTable({
        responsive: true,
        pageLength: 25,
        language: {
          url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
        }
      });
    {% endfor %}
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resultado</title>
    
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
        <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.tablesorter.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.tablesorter.widgets.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery.tablesorter.pager.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/tablesort.js') }}"></script>
        <script src="{{ url_for('static', filename='js/popper.min.js') }}"></script>
        
        <script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
    <!-- DataTables CSS -->
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css"> -->

    <!-- jQuery + DataTables JS -->
    <!-- <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script> -->
    <!-- <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script> -->

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> -->
    <style>
        pre {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { padding: 6px; border: 1px solid #ccc; }
        th { background-color: #f2f2f2; }
        h2 { margin-top: 30px; }
    </style>
</head>
<body class="bg-light">
    <h1>ONTs por Puerto</h1>
    <a href="/dashboard">Dashboard</a>



    <h2>Puerto </h2>
    <table id="tablesorting-1" class="display">
        <thead>
            <tr>
                <!-- <th>Card</th>
                <th>Slot</th> -->
                <th>Port</th><th>ont ID</th><th>Estado</th><th>Uptime</th><th>Downtime</th><th>Causa</th>
                <th>SN</th><th>Tipo</th><th>Distancia</th><th>Rx/Tx</th><th>Descripción</th>
                <th>SP</th><th>.</th><th>...</th>
            </tr>
        </thead>
        <tbody>
            {% for ont in datos_por_puerto %}
            <tr>
<!-- {'id': 85, 'card_id': 0, 'slot_id': 1, 'port_id': 5, 'ont_id': 9, 'state': 'online', 'uptime': '2025-06-27 00:44:45', 'downtime': '2025-06-27 00:43:50', 'cause': 'dying-gasp', 'SN': '48575443AEB2D7AF', 'type': 'EG8141A5-10', 'distance': '518', 'rx_tx': '-27.69/2.33', 'description': 'Luis H Gomez Henandez', 'sp': '73', 'cmd': '{"editar_url": "/editar/0/1/5/9", "borrar_ont": "/borrar_ont/0/1/5/9", "borrar_sp": "/borrar_sp/73"}', 'acciones': {'editar_url': '/editar/0/1/5/9', 'borrar_ont': '/borrar_ont/0/1/5/9', 'borrar_sp': '/borrar_sp/73'} -->
                <!-- <td>{{ ont.card_id }}</td>
                <td>{{ ont.slot_id }}</td> -->
                <td>{{ ont.port_id }}</td>
                <td>{{ ont.ont_id }}</td>
                <td>
                    {% if ont.state == 'online' %}
                        ✅                    
                    {% else %}
                        ❌                    
                    {% endif %}

                    </td>
            <!-- uptime, downtime, down_cause, sn, type, distance, rx_tx, description, service_port_num -->
                <td> {{ ont.uptime }} </td>
                <td> {{ ont.downtime }} </td>
                <td> {{ ont.cause }} </td>
                <td> {{ ont.SN }} </td>
                <td> {{ ont.type }} </td>
                <td> {{ ont.distance }} </td>
                <td> {{ ont.rx_tx }} </td>
                <td> {{ ont.description }} </td>
                <td> {{ ont.service_ports }} </td>

                <td>
                    {% if ont.sp is none %}
                        ❌
                    {% else %}
                        ✅
                    {% endif %}
                    {{ ont.cmd.borrar_ont }}
                </td>
                
                <td>
                    <span style="display:none" class="puerto_csv">{{ ont.service_ports }}</span>
                    <span style="display:none" class="ont_id_str">{{ ont.acciones[0].borrar_ont_sn }}</span>
                    
                    <!-- <a href="{{ ont.acciones.editar_url }}">Editar</a> | -->
                    <a href="{{ ont.cmd.borrar_ont }}">❌ Ont</a>                        
                    {% if ont.sp is none %}
                    {% else %}
                        <!-- <a href="{{ ont.acciones.borrar_ont }}{{ ont.acciones.borrar_sp }}">❌ Ont</a> -->                        
                    {% endif %}
                
                </td>
            </tr>
            {% endfor %}
        </tbody>
        <tfoot>
                  												<tr>
                  													<td colspan="9" class="pager form-horizontal">
                  														<button class="btn first"><i class="fa fa-step-backward"></i></button>
                  														<button class="btn prev"><i class="fa fa-arrow-left"></i></button>
                  														<span class="pagedisplay"></span> <!-- this can be any element, including an input -->
                  														<button class="btn next"><i class="fa fa-arrow-right"></i></button>
                  														<button class="btn last"><i class="fa fa-step-forward"></i></button>
                  														<select class="pagesize input-xs" title="Select page size">
                  															<option value="50" selected="selected">50</option>
                  															<option value="100" >100</option>
                  															<option value="200">200</option>
                  															<option value="300">300</option>
                  														</select>
                  														<select class="pagenum input-xs" title="Seleccione P&aacute;gina"></select>
                  													</td>
                  												</tr>
                  											</tfoot>
    </table>


<script>
  window.addEventListener('DOMContentLoaded', function () {
    const celdasCSV = document.querySelectorAll("span.puerto_csv");

    celdasCSV.forEach(td => {
      const texto = td.textContent.trim();

      if(texto == "" || texto == "None") {
        
        return;
      }
      if(!texto.includes(',')) {
        let borrar = td.parentElement.children.item(1)
        if(borrar != null) {
            //ont_id_str
            let url = `/borrar_ont_sn/${borrar.textContent}`;
            let link = document.createElement("a");
            link.href = url;
            link.textContent = `❌ onu_sn`;
            link.target = "_blank";
            td.parentElement.appendChild(link);
            
        }
        // console.log(texto);
        const url = `/borrar_sp/${texto}`;
        const link = document.createElement("a");
        link.href = url;
        link.textContent = `❌ sp:${texto}`;
        link.target = "_blank";
        // td.textContent = ""; // Limpiar contenido
        td.parentElement.appendChild(link);

        
      }else {      
      // Validar que sea una cadena CSV válida (mínimo 6 números separados por comas)

        
        const valores = texto.split(",");
        // Obtener los valores de los elementos
        valores.forEach((v, i) => {
            // console.log(v);
            // console.log(i);
            // Construir URL personalizada
            let url = `/borrar_sp/${v}`;
            // Crear y agregar el enlace
            let link = document.createElement("a");
            link.href = url;
            link.textContent = `❌ sp:${v}`;
            link.target = "_blank";
            //td.textContent = ""; // Limpiar contenido
            td.parentElement.appendChild(link);
            // console.log(url);

        })
      }

    });
  });
</script>


</body>
</html>
